{% extends 'tienda/base.html' %}
{% load static %}

{% block content %}
<div style="max-width: 1000px; margin: 40px auto; padding: 20px; display: flex; gap: 40px; background: white; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
    <!-- Imagen del producto -->
    <div style="flex: 1; display:flex; align-items:center; justify-content:center;">
        {% if producto.imagen %}
            <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" 
                 style="width: 100%; height: auto; max-height: 600px; object-fit: contain; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display:block; margin:auto;">
        {% else %}
            <img src="{% static 'img/no-image.png' %}" alt="Sin imagen" 
                 style="width: 100%; height: auto; max-height: 600px; object-fit: contain; border-radius: 10px; display:block; margin:auto;">
        {% endif %}
    </div>

    <!-- InformaciÃ³n del producto -->
    <div style="flex: 1; display: flex; flex-direction: column;">
        <h1 style="margin: 0 0 15px 0; color: #2d3748; font-size: 2.5em;">{{ producto.nombre }}</h1>
        
        <div style="background: #f7fafc; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
            <p style="font-size: 2em; color: #2f855a; margin: 0;">${{ producto.precio }}</p>
        </div>

        <div style="margin-bottom: 30px;">
            <h3 style="color: #4a5568; margin-bottom: 10px;">DescripciÃ³n:</h3>
            <p style="color: #4a5568; line-height: 1.6; font-size: 1.1em;">
                {{ producto.descripcion|default:"Sin descripciÃ³n disponible" }}
            </p>
        </div>

        <div style="margin-top: auto;">
            <!-- BotÃ³n de agregar al carrito -->
            <button class="btn-agregar" 
                    data-id="{{ producto.id }}"
                    style="width: 100%; background: #2f855a; color: white; border: none; 
                           padding: 15px 30px; border-radius: 10px; font-size: 1.2em; 
                           cursor: pointer; transition: all 0.3s ease; display: flex; 
                           align-items: center; justify-content: center; gap: 10px;">
                <span style="font-size: 1.4em;">ðŸ›’</span> 
                Agregar al carrito
            </button>

            {% if user.is_authenticated and producto.usuario == user %}
            <form method="post" action="{% url 'tienda:eliminar_producto' producto.id %}" 
                  style="margin-top: 15px;">
                {% csrf_token %}
                <button type="submit" 
                        style="width: 100%; background: #e53e3e; color: white; border: none; 
                               padding: 15px 30px; border-radius: 10px; font-size: 1.2em; 
                               cursor: pointer; transition: all 0.3s ease;">
                    ðŸ—‘ Eliminar producto
                </button>
            </form>
            {% endif %}
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const boton = document.querySelector(".btn-agregar");
    
    boton.addEventListener("click", () => {
        const productoId = boton.dataset.id;

        fetch(`/carrito/agregar/${productoId}/`, {
            method: "GET",
            headers: { "X-Requested-With": "XMLHttpRequest" }
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                const contador = document.getElementById("contador-carrito");
                if (contador) contador.textContent = data.total_items;

                boton.innerHTML = '<span style="font-size: 1.4em;">âœ…</span> Â¡Agregado al carrito!';
                boton.style.background = "#2b6cb0";
                
                setTimeout(() => {
                    boton.innerHTML = '<span style="font-size: 1.4em;">ðŸ›’</span> Agregar al carrito';
                    boton.style.background = "#2f855a";
                }, 1500);
            } else {
                alert("No se pudo agregar al carrito");
            }
        })
        .catch(err => console.error("Error:", err));
    });
});
</script>
{% endblock %}