{% extends 'tienda/base.html' %}

{% block content %}
<div style="max-width:800px; margin:40px auto; padding:0 20px;">
    <h2 style="text-align:center; color:#16a34a; margin-bottom:30px;">ğŸ’³ Finalizar compra</h2>

    <!-- Resumen del pedido -->
    <div style="background:white; border-radius:12px; padding:20px; box-shadow:0 2px 8px rgba(0,0,0,0.1); margin-bottom:30px;">
        <h3 style="color:#374151; margin-bottom:15px;">ğŸ“‹ Resumen del pedido</h3>
        
        <div style="max-height:300px; overflow-y:auto; margin-bottom:20px;">
            {% for item in items %}
            <div style="display:flex; gap:15px; padding:10px 0; border-bottom:1px solid #e5e7eb;">
                {% if item.producto.imagen %}
                    <img src="{{ item.producto.imagen.url }}" alt="{{ item.producto.nombre }}" 
                         style="width:60px; height:60px; object-fit:cover; border-radius:8px;">
                {% endif %}
                <div style="flex:1;">
                    <h4 style="margin:0; color:#111827;">{{ item.producto.nombre }}</h4>
                    <p style="color:#6b7280; font-size:0.9rem; margin:5px 0;">{{ item.producto.descripcion|truncatechars:80 }}</p>
                    <div style="display:flex; justify-content:space-between; margin-top:5px;">
                        <span>Cantidad: {{ item.cantidad }}</span>
                        <span>${{ item.producto.precio }} c/u</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <div style="border-top:2px solid #e5e7eb; padding-top:15px; text-align:right;">
            <p style="font-size:1.2rem; font-weight:600; color:#16a34a;">
                Total a pagar: ${{ total|floatformat:2 }}
            </p>
        </div>
    </div>

    <!-- Formulario de pago -->
    <div style="background:white; border-radius:12px; padding:20px; box-shadow:0 2px 8px rgba(0,0,0,0.1);">
        <h3 style="color:#374151; margin-bottom:20px;">ğŸ’³ Selecciona tu mÃ©todo de pago</h3>
        
        <form method="post" action="{% url 'tienda:procesar_pago' %}" style="display:grid; gap:20px;">
            {% csrf_token %}
            
            <!-- SelecciÃ³n de mÃ©todo de pago -->
            <div style="display:grid; gap:12px;">
                <!-- Usamos input + label como hermanos para poder estilizar solo la opciÃ³n seleccionada -->
                <input class="payment-input" type="radio" id="mp-radio" name="metodo_pago" value="mercadopago" checked>
                <label for="mp-radio" class="payment-option" style="display:flex; align-items:center; padding:12px; border:2px solid #e5e7eb; border-radius:8px; cursor:pointer; background:#ffffff; transition:all 0.2s ease;">
                    <span class="dot" style="display:inline-block; width:18px; height:18px; border-radius:50%; border:2px solid #94a3b8; margin-right:10px; box-sizing:border-box;"></span>
                    <div style="flex:1;">
                        <span style="font-weight:600; color:#374151;">ğŸ’³ Mercado Pago</span>
                        <p style="color:#6b7280; font-size:0.9rem; margin:5px 0 0 0;">Transferencia, tarjeta de crÃ©dito, efectivo y mÃ¡s</p>
                    </div>
                </label>

                <input class="payment-input" type="radio" id="local-radio" name="metodo_pago" value="tarjeta_local">
                <label for="local-radio" class="payment-option" style="display:flex; align-items:center; padding:12px; border:2px solid #e5e7eb; border-radius:8px; cursor:pointer; background:#ffffff; transition:all 0.2s ease;">
                    <span class="dot" style="display:inline-block; width:18px; height:18px; border-radius:50%; border:2px solid #94a3b8; margin-right:10px; box-sizing:border-box;"></span>
                    <div style="flex:1;">
                        <span style="font-weight:600; color:#374151;">ğŸª Tarjeta local (demo)</span>
                        <p style="color:#6b7280; font-size:0.9rem; margin:5px 0 0 0;">SimulaciÃ³n de pago con tarjeta (solo para pruebas)</p>
                    </div>
                </label>
            </div>
            
            <!-- InformaciÃ³n personal (requerida) -->
            <div style="display:grid; gap:15px;">
                <h4 style="color:#374151; margin:0;">ğŸ“‹ InformaciÃ³n de envÃ­o</h4>
                <div>
                    <label for="nombre" style="display:block; margin-bottom:5px; color:#374151; font-weight:500;">Nombre completo *</label>
                        <input type="text" id="nombre" name="nombre" required placeholder="Ej: Juan PÃ©rez" value="{% if user.first_name or user.last_name %}{{ user.first_name }} {{ user.last_name }}{% else %}{{ user.username }}{% endif %}"
                           style="width:100%; padding:8px; border:2px solid #e5e7eb; border-radius:8px;">
                </div>
                
                <div>
                    <label for="email" style="display:block; margin-bottom:5px; color:#374151; font-weight:500;">Email *</label>
                    <input type="email" id="email" name="email" required value="{{ user.email }}"
                           style="width:100%; padding:8px; border:2px solid #e5e7eb; border-radius:8px;">
                </div>
            </div>

            <div style="display:flex; gap:12px;">
                <a href="{% url 'tienda:ver_carrito' %}" style="flex:1; text-align:center; padding:12px; border:2px solid #d1d5db; border-radius:8px; color:#4b5563; text-decoration:none; font-weight:600; transition:all 0.3s ease;">
                    â† Volver al carrito
                </a>
                <button type="submit" 
                        style="flex:1; background:#16a34a; color:white; padding:12px; border:none; border-radius:8px; 
                               font-weight:600; cursor:pointer; transition:all 0.3s ease;">
                    Continuar al pago â†’
                </button>
            </div>
        </form>
    </div>
</div>

<style>
    input:focus {
        outline: none;
        border-color: #16a34a;
    }

    button[type="submit"]:hover {
        background: #15803d;
        transform: translateY(-2px);
    }
    /* Estilos para opciones de pago: solo la opciÃ³n seleccionada se pone verde */
    input.payment-input {
        position: absolute;
        left: -9999px;
    }
    input.payment-input:checked + label.payment-option {
        border-color: #16a34a;
        background: #f0fdf4;
    }
    input.payment-input:checked + label.payment-option .dot {
        background: #16a34a;
        border-color: #16a34a;
    }
    label.payment-option { transition: all 0.15s ease; }
</style>
{% endblock %}